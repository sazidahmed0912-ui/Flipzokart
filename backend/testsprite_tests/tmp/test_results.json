[
  {
    "projectId": "a6dcd383-d45f-4e6f-8256-09521c657cd6",
    "testId": "a8b8b6ba-2eae-4fc8-bcad-820eb6141569",
    "userId": "34d8e438-1081-7025-6dfe-092cb8b46084",
    "title": "TC001-send otp to email success",
    "description": "Test the /api/auth/send-email-otp endpoint to ensure it successfully sends a 6-digit OTP to the provided email address and responds with a success status.",
    "code": "import requests\n\ndef test_send_otp_to_email_success():\n    base_url = \"http://localhost:5000\"\n    endpoint = \"/api/auth/send-email-otp\"\n    url = base_url + endpoint\n    headers = {\"Content-Type\": \"application/json\"}\n    payload = {\"email\": \"test.user@example.com\"}\n    timeout_seconds = 30\n\n    try:\n        response = requests.post(url, json=payload, headers=headers, timeout=timeout_seconds)\n    except requests.Timeout:\n        assert False, \"Request timed out while sending OTP to email\"\n    except requests.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n\n    assert response.status_code == 200, f\"Expected status code 200 but got {response.status_code}\"\n    # The response body is unspecified for success, assume empty or any content is success.\n    # If there is a specific success field, we could check here, but per PRD only status 200 is defined.\n\ntest_send_otp_to_email_success()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-01-28T08:33:46.798Z",
    "modified": "2026-01-28T08:34:00.172Z"
  },
  {
    "projectId": "a6dcd383-d45f-4e6f-8256-09521c657cd6",
    "testId": "a0d83b18-f74d-4fb0-a61a-ddabe47ace57",
    "userId": "34d8e438-1081-7025-6dfe-092cb8b46084",
    "title": "TC002-verify otp and login success",
    "description": "Test the /api/auth/verify-email-otp endpoint to verify that it correctly validates the provided OTP, registers a new user if name and password are provided, hashes the password securely, and returns a JWT token upon successful login.",
    "code": "import requests\nimport time\n\nBASE_URL = \"http://localhost:5000\"\nHEADERS = {\"Content-Type\": \"application/json\"}\nTIMEOUT = 30\n\n\ndef test_verify_otp_and_login_success():\n    email = \"testuser@example.com\"\n    name = \"Test User\"\n    password = \"StrongP@ssw0rd!\"\n    otp = None\n    token = None\n\n    try:\n        # Step 1: Request OTP to be sent to email\n        send_otp_resp = requests.post(\n            f\"{BASE_URL}/api/auth/send-email-otp\",\n            json={\"email\": email},\n            headers=HEADERS,\n            timeout=TIMEOUT,\n        )\n        assert send_otp_resp.status_code == 200, f\"Send OTP failed: {send_otp_resp.text}\"\n\n        # As the system sends OTP asynchronously via email, wait briefly for OTP to be generated.\n        # No direct access to OTP from the API, so poll or simulate waiting.\n        # In a real test environment, OTP might be fetched from a test mailbox or test hook.\n        # Here, we simulate retry fetching OTP from a hypothetical test endpoint (not in PRD)\n        # since no such endpoint is specified, we wait fixed time to simulate manual OTP.\n\n        # Wait up to 25 seconds to simulate user receiving OTP email\n        # In a real scenario, fetch OTP from DB or mock\n        time.sleep(5)  # wait 5 seconds as placeholder\n\n        # For this test, assume OTP is known or dummy for testing, e.g. \"123456\"\n        # Normally OTP should be captured dynamically; here we use placeholder:\n        otp = \"123456\"\n\n        verify_payload = {\n            \"email\": email,\n            \"otp\": otp,\n            \"name\": name,\n            \"password\": password\n        }\n\n        # Step 2: Verify OTP and login/register user\n        verify_resp = requests.post(\n            f\"{BASE_URL}/api/auth/verify-email-otp\",\n            json=verify_payload,\n            headers=HEADERS,\n            timeout=TIMEOUT,\n        )\n        assert verify_resp.status_code == 200, f\"Verify OTP failed: {verify_resp.text}\"\n\n        json_resp = verify_resp.json()\n        assert \"token\" in json_resp, \"JWT token not found in response\"\n        token = json_resp[\"token\"]\n        assert isinstance(token, str) and len(token) > 0, \"Invalid JWT token\"\n\n    except requests.Timeout:\n        assert False, \"Request timed out\"\n    except requests.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n\n\ntest_verify_otp_and_login_success()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 67, in <module>\n  File \"<string>\", line 54, in test_verify_otp_and_login_success\nAssertionError: Verify OTP failed: {\"message\":\"Invalid or expired OTP\"}\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-01-28T08:33:46.803Z",
    "modified": "2026-01-28T08:34:19.829Z"
  }
]
