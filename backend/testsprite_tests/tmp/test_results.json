[
  {
    "projectId": "b48a76d1-7cbd-4f9c-9834-320212588fe2",
    "testId": "8b0114a7-de30-4590-a6f5-68942bdb36df",
    "userId": "34d8e438-1081-7025-6dfe-092cb8b46084",
    "title": "TC003-test email service integration with zoho mail rest api",
    "description": "Verify that the email service sends emails using Zoho Mail REST API via Axios (not Nodemailer) without auth errors and handles API failures gracefully.",
    "code": "import os\nimport requests\nimport json\n\ndef test_email_service_integration_with_zoho_mail_rest_api():\n    base_url = \"http://localhost:5000\"\n    email_send_endpoint = f\"{base_url}/email/send\"  # Assuming this endpoint triggers sending email via Zoho Mail REST API\n\n    # Prepare email payload\n    payload = {\n        \"to\": \"recipient@example.com\",\n        \"subject\": \"Test Email from Zoho Mail REST API\",\n        \"body\": \"This is a test email sent via Zoho Mail REST API integration.\"\n    }\n    headers = {\n        \"Content-Type\": \"application/json\"\n    }\n\n    # Check for presence of Zoho OAuth token environment variable to determine real or mocked test\n    zoho_oauth_token = os.getenv(\"ZOHO_OAUTH_TOKEN\")\n\n    try:\n        # Send email request to local email service\n        response = requests.post(email_send_endpoint, headers=headers, data=json.dumps(payload), timeout=30)\n        response.raise_for_status()\n    except requests.exceptions.RequestException as e:\n        # If network or request error, assert failure and message\n        assert False, f\"Request to email sending service failed: {e}\"\n\n    resp_json = {}\n    try:\n        resp_json = response.json()\n    except ValueError:\n        assert False, \"Response is not valid JSON\"\n\n    # Validate Zoho API response structure and success status\n    # According to Zoho Mail API docs, success returns HTTP 200 with JSON containing 'status' or 'code' fields.\n    # Since we are testing via local email service, that internally uses Zoho REST API via Axios:\n    # We'll assume the response JSON includes a 'zohoResponse' field that mirrors Zoho API raw response\n    assert \"zohoResponse\" in resp_json, \"Response JSON missing 'zohoResponse' key\"\n    zoho_resp = resp_json[\"zohoResponse\"]\n    assert isinstance(zoho_resp, dict), \"'zohoResponse' should be a dictionary\"\n\n    # Check for typical Zoho Mail API success indicator, e.g. status=200 or code=200\n    status_code = zoho_resp.get(\"status\") or zoho_resp.get(\"code\") or zoho_resp.get(\"statusCode\")\n    assert status_code == 200, f\"Zoho API did not return status 200, got: {status_code}\"\n\n    # Also check no auth errors in the response\n    errors = zoho_resp.get(\"errors\") or []\n    assert not errors, f\"Zoho API returned errors: {errors}\"\n\n    # In case of token not set, the service should handle gracefully without crashing\n    if not zoho_oauth_token:\n        # If token is missing, the service should respond with a clear error but handle gracefully\n        # In that case, ensure the response has an error message related to auth failure\n        if status_code != 200:\n            err_msg = zoho_resp.get(\"message\") or zoho_resp.get(\"error_description\") or \"\"\n            assert \"auth\" in err_msg.lower() or \"token\" in err_msg.lower(), \"Expected auth failure message missing\"\n\n\ntest_email_service_integration_with_zoho_mail_rest_api()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"<string>\", line 25, in test_email_service_integration_with_zoho_mail_rest_api\n  File \"/var/task/requests/models.py\", line 1024, in raise_for_status\n    raise HTTPError(http_error_msg, response=self)\nrequests.exceptions.HTTPError: 404 Client Error: Not Found for url: http://localhost:5000/email/send\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 61, in <module>\n  File \"<string>\", line 28, in test_email_service_integration_with_zoho_mail_rest_api\nAssertionError: Request to email sending service failed: 404 Client Error: Not Found for url: http://localhost:5000/email/send\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-01-29T09:16:18.976Z",
    "modified": "2026-01-29T09:16:33.097Z"
  }
]
