[
  {
    "projectId": "9b2c9997-2f0a-410a-85c9-1c98ab67fd61",
    "testId": "0015f9c7-90f9-46c4-b9b5-c7161455a4ad",
    "userId": "34d8e438-1081-7025-6dfe-092cb8b46084",
    "title": "TC001-test create product with image upload",
    "description": "Verify that a product can be created successfully with all required fields and an image uploaded, ensuring the image is stored and linked correctly.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:5000\"\nTIMEOUT = 30\nPRODUCTS_ENDPOINT = f\"{BASE_URL}/products\"\n\ndef test_create_product_with_image_upload():\n    # Prepare product data\n    product_data = {\n        \"name\": \"Test Product\",\n        \"description\": \"A product created for testing image upload.\",\n        \"price\": 19.99,\n        \"category\": \"Test Category\"\n    }\n    # Prepare image file to upload\n    # For the purpose of this test, we simulate an image file with bytes\n    image_content = b\"\\x89PNG\\r\\n\\x1a\\n\\x00\\x00\\x00\\rIHDR\\x00\"\n    files = {\n        \"image\": (\"test_image.png\", image_content, \"image/png\")\n    }\n    # Fields data will be sent as form-data with files in multipart request\n    # merge product_data into the data field for multipart/form-data request\n    data = {\n        \"name\": product_data[\"name\"],\n        \"description\": product_data[\"description\"],\n        \"price\": str(product_data[\"price\"]),\n        \"category\": product_data[\"category\"]\n    }\n    created_product_id = None\n\n    try:\n        response = requests.post(\n            PRODUCTS_ENDPOINT,\n            data=data,\n            files=files,\n            timeout=TIMEOUT\n        )\n        response.raise_for_status()\n        resp_json = response.json()\n\n        # Check basic product fields existence\n        assert resp_json.get(\"name\") == product_data[\"name\"], \"Product name mismatch\"\n        assert resp_json.get(\"description\") == product_data[\"description\"], \"Product description mismatch\"\n        assert float(resp_json.get(\"price\", 0)) == product_data[\"price\"], \"Product price mismatch\"\n        assert resp_json.get(\"category\") == product_data[\"category\"], \"Product category mismatch\"\n\n        # Verify the 'images' array field is present and populated\n        images = resp_json.get(\"images\")\n        assert isinstance(images, list), \"'images' field is not a list\"\n        assert len(images) > 0, \"'images' array is empty\"\n        # Each image object should have at least a URL or ID, check first entry\n        first_image = images[0]\n        assert isinstance(first_image, dict), \"Each image entry should be a dict\"\n        assert any(key in first_image for key in [\"url\", \"id\", \"filename\"]), \"Image object missing expected keys\"\n\n        # Save product ID for cleanup\n        created_product_id = resp_json.get(\"id\") or resp_json.get(\"_id\")\n        assert created_product_id, \"Created product ID not found in response\"\n\n    except requests.exceptions.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n    finally:\n        # Cleanup - delete the created product if it exists\n        if created_product_id:\n            try:\n                del_response = requests.delete(\n                    f\"{PRODUCTS_ENDPOINT}/{created_product_id}\",\n                    timeout=TIMEOUT\n                )\n                # Allow 200-299 range status for deletion success\n                assert del_response.status_code >= 200 and del_response.status_code < 300, \\\n                    f\"Failed to delete product during cleanup, status code: {del_response.status_code}\"\n            except requests.exceptions.RequestException:\n                pass\n\n\ntest_create_product_with_image_upload()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"<string>\", line 38, in test_create_product_with_image_upload\n  File \"/var/task/requests/models.py\", line 1024, in raise_for_status\n    raise HTTPError(http_error_msg, response=self)\nrequests.exceptions.HTTPError: 503 Server Error: Service Unavailable for url: http://localhost:5000/products\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 77, in <module>\n  File \"<string>\", line 61, in test_create_product_with_image_upload\nAssertionError: Request failed: 503 Server Error: Service Unavailable for url: http://localhost:5000/products\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-01-31T14:52:55.725Z",
    "modified": "2026-01-31T14:53:09.307Z"
  },
  {
    "projectId": "9b2c9997-2f0a-410a-85c9-1c98ab67fd61",
    "testId": "2a85b798-a16a-4f6d-b939-f3ae526a00c6",
    "userId": "34d8e438-1081-7025-6dfe-092cb8b46084",
    "title": "TC002-test read product details",
    "description": "Verify that product details can be retrieved correctly by product ID, including all product information and associated image data.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:5000\"\nTIMEOUT = 30\nHEADERS = {\n    \"Content-Type\": \"application/json\"\n}\n\ndef test_read_product_details():\n    # First create a product to ensure a valid product ID for read test\n    product_payload = {\n        \"name\": \"Test Product\",\n        \"description\": \"A product created for testing read functionality.\",\n        \"price\": 19.99,\n        \"images\": [\n            {\n                \"url\": \"http://example.com/image1.jpg\",\n                \"altText\": \"Test Image 1\"\n            }\n        ],\n        \"category\": \"Test Category\",\n        \"stock\": 10\n    }\n    product_id = None\n\n    try:\n        # Create product\n        create_resp = requests.post(\n            f\"{BASE_URL}/products\",\n            json=product_payload,\n            headers=HEADERS,\n            timeout=TIMEOUT\n        )\n        assert create_resp.status_code == 201, f\"Expected 201 Created but got {create_resp.status_code}\"\n        create_data = create_resp.json()\n        assert \"id\" in create_data or \"_id\" in create_data, \"Product creation response missing product ID\"\n        product_id = create_data.get(\"id\") or create_data.get(\"_id\")\n        assert product_id is not None, \"Product ID is None\"\n\n        # Read product details by product_id\n        read_resp = requests.get(\n            f\"{BASE_URL}/products/{product_id}\",\n            headers=HEADERS,\n            timeout=TIMEOUT\n        )\n        assert read_resp.status_code == 200, f\"Expected 200 OK but got {read_resp.status_code}\"\n        product_data = read_resp.json()\n\n        # Assert all product info is present\n        expected_fields = [\"id\", \"_id\", \"name\", \"description\", \"price\", \"images\", \"category\", \"stock\"]\n        # product_data may have either \"id\" or \"_id\" so check at least one present\n        assert any(field in product_data for field in [\"id\", \"_id\"]), \"Missing product ID in read response\"\n\n        for field in [\"name\", \"description\", \"price\", \"category\", \"stock\"]:\n            assert field in product_data, f\"Missing field '{field}' in product details\"\n\n        # Check images field exists and is a list\n        assert \"images\" in product_data, \"'images' field is missing in product details\"\n        images = product_data[\"images\"]\n        assert isinstance(images, list), \"'images' field is not a list\"\n\n        # Check images array is correctly populated (at least one image with required fields)\n        assert len(images) > 0, \"'images' array is empty\"\n        for image in images:\n            assert isinstance(image, dict), \"Image item is not a dictionary\"\n            assert \"url\" in image and isinstance(image[\"url\"], str) and image[\"url\"], \"Image missing valid 'url'\"\n            assert \"altText\" in image and isinstance(image[\"altText\"], str), \"Image missing 'altText'\"\n\n    finally:\n        if product_id:\n            # Cleanup: delete the created product\n            try:\n                del_resp = requests.delete(\n                    f\"{BASE_URL}/products/{product_id}\",\n                    headers=HEADERS,\n                    timeout=TIMEOUT\n                )\n                # It's okay if product was already deleted or not found, ignore errors here\n            except Exception:\n                pass\n\ntest_read_product_details()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 82, in <module>\n  File \"<string>\", line 34, in test_read_product_details\nAssertionError: Expected 201 Created but got 503\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-01-31T14:52:55.732Z",
    "modified": "2026-01-31T14:53:09.413Z"
  },
  {
    "projectId": "9b2c9997-2f0a-410a-85c9-1c98ab67fd61",
    "testId": "af114d03-f7b5-418e-ae95-75eae8dfe8ad",
    "userId": "34d8e438-1081-7025-6dfe-092cb8b46084",
    "title": "TC003-test update product information and image",
    "description": "Verify that product information and its image can be updated successfully, and changes are reflected in the database.",
    "code": "import requests\nimport io\n\nBASE_URL = \"http://localhost:5000\"\nTIMEOUT = 30\nHEADERS = {\n    # Assuming no auth is required; if required, include here\n    # Example: \"Authorization\": \"Bearer <token>\"\n}\n\ndef test_update_product_information_and_image():\n    # Step 1: Create a product to update\n    create_url = f\"{BASE_URL}/products\"\n    product_data = {\n        \"name\": \"Test Product\",\n        \"description\": \"Initial description\",\n        \"price\": \"10.99\",\n        \"category\": \"Test Category\"\n    }\n    image_content = io.BytesIO(b\"initial image content\")\n    files = {\n        \"images\": (\"initial_image.jpg\", image_content, \"image/jpeg\")\n    }\n\n    create_resp = requests.post(create_url, headers=HEADERS, data=product_data, files=files, timeout=TIMEOUT)\n    assert create_resp.status_code == 201, f\"Failed to create product: {create_resp.text}\"\n    created_product = create_resp.json()\n    product_id = created_product.get(\"_id\") or created_product.get(\"id\")\n    assert product_id, \"Created product ID not returned\"\n    assert \"images\" in created_product and isinstance(created_product[\"images\"], list), \"'images' array missing or incorrect in create response\"\n    assert len(created_product[\"images\"]) >= 1, \"No images found in create response\"\n\n    try:\n        # Step 2: Update product information and image\n        update_url = f\"{BASE_URL}/products/{product_id}\"\n        updated_product_data = {\n            \"name\": \"Updated Test Product\",\n            \"description\": \"Updated description\",\n            \"price\": \"15.99\",\n            \"category\": \"Updated Category\"\n        }\n        updated_image_content = io.BytesIO(b\"updated image content\")\n        update_files = {\n            \"images\": (\"updated_image.jpg\", updated_image_content, \"image/jpeg\")\n        }\n        update_resp = requests.put(update_url, headers=HEADERS, data=updated_product_data, files=update_files, timeout=TIMEOUT)\n        assert update_resp.status_code == 200, f\"Failed to update product: {update_resp.text}\"\n        updated_product = update_resp.json()\n\n        # Validate updated fields\n        assert updated_product.get(\"name\") == updated_product_data[\"name\"], \"Product name not updated\"\n        assert updated_product.get(\"description\") == updated_product_data[\"description\"], \"Product description not updated\"\n        assert float(updated_product.get(\"price\")) == float(updated_product_data[\"price\"]), \"Product price not updated\"\n        assert updated_product.get(\"category\") == updated_product_data[\"category\"], \"Product category not updated\"\n\n        # Validate images array\n        assert \"images\" in updated_product and isinstance(updated_product[\"images\"], list), \"'images' array missing or incorrect in update response\"\n        assert any(\"updated_image.jpg\" in (img.get(\"filename\", \"\") if isinstance(img, dict) else img) for img in updated_product[\"images\"]), \"Updated image not found in 'images' array\"\n\n        # Step 3: Retrieve product and verify updates are persisted\n        get_url = f\"{BASE_URL}/products/{product_id}\"\n        get_resp = requests.get(get_url, headers=HEADERS, timeout=TIMEOUT)\n        assert get_resp.status_code == 200, f\"Failed to get product after update: {get_resp.text}\"\n        gotten_product = get_resp.json()\n\n        # Verify data matches update response\n        assert gotten_product.get(\"name\") == updated_product_data[\"name\"], \"Persisted product name mismatch\"\n        assert gotten_product.get(\"description\") == updated_product_data[\"description\"], \"Persisted product description mismatch\"\n        assert float(gotten_product.get(\"price\")) == float(updated_product_data[\"price\"]), \"Persisted product price mismatch\"\n        assert gotten_product.get(\"category\") == updated_product_data[\"category\"], \"Persisted product category mismatch\"\n        assert \"images\" in gotten_product and isinstance(gotten_product[\"images\"], list), \"'images' array missing or incorrect in get response\"\n        assert any(\"updated_image.jpg\" in (img.get(\"filename\", \"\") if isinstance(img, dict) else img) for img in gotten_product[\"images\"]), \"Updated image not persisted in 'images' array\"\n\n    finally:\n        # Clean up - delete the created product\n        del_url = f\"{BASE_URL}/products/{product_id}\"\n        del_resp = requests.delete(del_url, headers=HEADERS, timeout=TIMEOUT)\n        assert del_resp.status_code in (200, 204), f\"Failed to delete product: {del_resp.text}\"\n\ntest_update_product_information_and_image()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 80, in <module>\n  File \"<string>\", line 26, in test_update_product_information_and_image\nAssertionError: Failed to create product: \n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2026-01-31T14:52:55.738Z",
    "modified": "2026-01-31T14:53:42.534Z"
  }
]
